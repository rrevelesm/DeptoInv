<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Padr√≥n de Investigadores UPIIZ - IPN</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            position: relative;
            min-height: 100vh;
            padding: 20px;
        }

        body {
            background: linear-gradient(135deg, #6B1F3D 0%, #8B2F4D 100%);
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #6B1F3D 0%, #8B2F4D 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .banner-image {
            width: 100%;
            overflow: hidden;
        }

        .banner-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .header-logos {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .header-logo {
            height: 120px;
            width: auto;
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.25);
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .form-content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
        }

        .section-title {
            font-size: 1.6rem;
            color: #6B1F3D;
            margin-bottom: 25px;
            padding: 15px 20px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-left: 6px solid #6B1F3D;
            border-radius: 8px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
            box-shadow: 0 2px 8px rgba(107, 31, 61, 0.1);
        }

        .section-title span:first-child {
            font-size: 1.8rem;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .required {
            color: #e74c3c;
        }

        input[type="text"],
        input[type="email"],
        input[type="date"],
        input[type="url"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #6B1F3D;
            box-shadow: 0 0 0 3px rgba(107, 31, 61, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        .radio-group,
        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .radio-label,
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        input[type="radio"],
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .conditional-field {
            margin-left: 30px;
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .conditional-field.active {
            display: block;
        }

        .line-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }

        .line-item input {
            flex: 1;
        }

        .btn-add {
            background: #28a745;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .btn-remove {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .submit-container {
            text-align: center;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .btn-submit {
            background: linear-gradient(135deg, #6B1F3D 0%, #8B2F4D 100%);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(107, 31, 61, 0.3);
        }

        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(107, 31, 61, 0.4);
        }

        .help-text {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }

        .footer {
            background: linear-gradient(135deg, #6B1F3D 0%, #8B2F4D 100%);
            padding: 20px;
            text-align: center;
            color: white;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .form-content {
                padding: 20px;
            }
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-logos">
                <img src="/static/logo_upiiz.png" alt="Logo UPIIZ" class="header-logo">
                <img src="/static/logo_ipn.png" alt="Logo IPN" class="header-logo">
            </div>
            <h1>üéì Padr√≥n de Investigadores UPIIZ</h1>
            <p style="font-size: 1rem; font-weight: 500; margin-bottom: 15px; color: #D4AF37;">
                Registro de L√≠neas de Investigaci√≥n y Productividad Acad√©mica 2025
            </p>
            <p style="font-size: 1.1rem; font-weight: 600; margin-bottom: 5px;">
                Unidad Profesional Interdisciplinaria de Ingenier√≠a<br>
                Campus Zacatecas - UPIIZ
            </p>
            <p style="font-size: 0.95rem;">Instituto Polit√©cnico Nacional</p>
            <p style="font-size: 0.85rem; margin-top: 10px; opacity: 0.95;">
                <strong>Jefe del Departamento de Investigaci√≥n:</strong><br>
                M. en C. Rafael Reveles Mart√≠nez
            </p>
            <p style="font-size: 0.85rem; margin-top: 8px; opacity: 0.95;">
                üìß <a href="mailto:investigacion_UPIIZ@ipn.mx" 
                      style="color: #D4AF37; text-decoration: none; font-weight: 600;">
                    investigacion_UPIIZ@ipn.mx
                </a>
            </p>
            <p style="font-size: 0.85rem; margin-top: 5px; opacity: 0.95;">
                üì± Cel. 492 250 4428 ‚Ä¢ Extensi√≥n: 83530
            </p>
            <p style="font-size: 0.85rem; margin-top: 8px;">
                <a href="https://www.zacatecas.ipn.mx/" target="_blank" 
                   style="color: #D4AF37; text-decoration: none; font-weight: 600;">
                    üåê www.zacatecas.ipn.mx
                </a>
            </p>
        </div>

        <!-- Imagen Banner UPIIZ -->
        <div class="banner-image">
            <img src="/static/fondo_upiiz.jpg" alt="Campus UPIIZ">
        </div>

        <!-- Rese√±a del Departamento -->
        <div style="background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%); padding: 30px 40px; border-bottom: 4px solid #D4AF37;">
            <div style="max-width: 900px; margin: 0 auto;">
                <h2 style="color: #6B1F3D; font-size: 1.5rem; margin-bottom: 15px; text-align: center;">
                    üìä Importancia de la Gesti√≥n de Informaci√≥n
                </h2>
                <p style="color: #333; line-height: 1.8; text-align: justify; margin-bottom: 12px;">
                    El <strong>Departamento de Investigaci√≥n de la UPIIZ</strong> mantiene un registro actualizado de investigadores para facilitar y agilizar diversos tr√°mites y procesos institucionales. La <strong>informaci√≥n recopilada en este padr√≥n</strong> es utilizada para:
                </p>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #6B1F3D;">
                        <strong style="color: #6B1F3D;">üéØ Tr√°mites y Convocatorias</strong>
                        <ul style="margin: 8px 0 0 20px; color: #555; line-height: 1.6;">
                            <li>Participaci√≥n en proyectos SIP</li>
                            <li>Solicitud de est√≠mulos EDI</li>
                            <li>Registro de productividad acad√©mica</li>
                        </ul>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #6B1F3D;">
                        <strong style="color: #6B1F3D;">üìà Reportes Institucionales</strong>
                        <ul style="margin: 8px 0 0 20px; color: #555; line-height: 1.6;">
                            <li>Indicadores de investigaci√≥n UPIIZ</li>
                            <li>Acreditaciones y evaluaciones</li>
                            <li>Vinculaci√≥n acad√©mica</li>
                        </ul>
                    </div>
                </div>
                <p style="color: #555; line-height: 1.8; text-align: center; font-style: italic; margin-top: 15px;">
                    La informaci√≥n actualizada nos permite <strong>agilizar tr√°mites administrativos y mejorar el servicio</strong> a los investigadores de la UPIIZ.
                </p>
            </div>
        </div>

        <div class="form-content">
            <div class="success-message" id="successMessage">
                ‚úì Formulario enviado exitosamente. Gracias por su participaci√≥n.
            </div>
            <div class="error-message" id="errorMessage">
                ‚úó Error al enviar el formulario. Por favor, intente nuevamente.
            </div>

            <form id="investigadorForm">
                <!-- Secci√≥n 1: Datos Personales -->
                <div class="section">
                    <div class="section-title">
                        <span>üë§</span>
                        <span>Datos Personales</span>
                    </div>

                    <div class="form-group">
                        <label for="nombres">Nombre(s) <span class="required">*</span></label>
                        <input type="text" id="nombres" name="nombres" required 
                               placeholder="Ej: Juan Carlos">
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="apellidoPaterno">Apellido Paterno <span class="required">*</span></label>
                            <input type="text" id="apellidoPaterno" name="apellidoPaterno" required 
                                   placeholder="Ej: Garc√≠a">
                        </div>

                        <div class="form-group">
                            <label for="apellidoMaterno">Apellido Materno <span class="required">*</span></label>
                            <input type="text" id="apellidoMaterno" name="apellidoMaterno" required 
                                   placeholder="Ej: L√≥pez">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="curp">CURP <span class="required">*</span></label>
                            <input type="text" id="curp" name="curp" required 
                                   placeholder="18 caracteres"
                                   maxlength="18"
                                   pattern="[A-Z]{4}[0-9]{6}[HM][A-Z]{5}[0-9A-Z][0-9]"
                                   style="text-transform: uppercase;">
                            <div class="help-text">
                                Clave √önica de Registro de Poblaci√≥n (18 caracteres)
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="fechaNacimiento">Fecha de Nacimiento <span class="required">*</span></label>
                            <input type="date" id="fechaNacimiento" name="fechaNacimiento" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>G√©nero <span class="required">*</span></label>
                            <select id="genero" name="genero" required>
                                <option value="">Seleccione...</option>
                                <option value="Femenino">Femenino</option>
                                <option value="Masculino">Masculino</option>
                                <option value="Otro">Otro</option>
                                <option value="Prefiero no decirlo">Prefiero no decirlo</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="claveEmpleado">Clave de Empleado <span class="required">*</span></label>
                            <input type="text" id="claveEmpleado" name="claveEmpleado" required 
                                   placeholder="Ej: 12345">
                        </div>
                    </div>

                    <div class="form-row">
                    <div class="form-group">
                            <label for="fechaIngresoIPN">Fecha de Ingreso al IPN <span class="required">*</span></label>
                            <input type="date" id="fechaIngresoIPN" name="fechaIngresoIPN" required>
                            <div class="help-text">
                                Fecha en que ingres√≥ como trabajador del IPN
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="cvu">CVU (antes CONACYT)</label>
                        <input type="text" id="cvu" name="cvu" 
                                   placeholder="6 o 7 d√≠gitos"
                               maxlength="7"
                                   pattern="[0-9]{6,7}">
                        <div class="help-text">
                                Opcional - Acepta CVU de 6 d√≠gitos (antiguo) o 7 d√≠gitos (actual)
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="categoria">Categor√≠a <span class="required">*</span></label>
                        <select id="categoria" name="categoria" required>
                            <option value="">Seleccione...</option>
                            <option value="Profesor Titular A">Profesor Titular A</option>
                            <option value="Profesor Titular B">Profesor Titular B</option>
                            <option value="Profesor Titular C">Profesor Titular C</option>
                            <option value="Profesor Asociado A">Profesor Asociado A</option>
                            <option value="Profesor Asociado B">Profesor Asociado B</option>
                            <option value="Profesor Asociado C">Profesor Asociado C</option>
                            <option value="Profesor Asistente A">Profesor Asistente A</option>
                            <option value="Profesor Asistente B">Profesor Asistente B</option>
                            <option value="Profesor Asistente C">Profesor Asistente C</option>
                            <option value="T√©cnico Acad√©mico Titular A">T√©cnico Acad√©mico Titular A</option>
                            <option value="T√©cnico Acad√©mico Titular B">T√©cnico Acad√©mico Titular B</option>
                            <option value="T√©cnico Acad√©mico Titular C">T√©cnico Acad√©mico Titular C</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="tipoPlaza">Tipo de Plaza <span class="required">*</span></label>
                            <select id="tipoPlaza" name="tipoPlaza" required>
                                <option value="">Seleccione...</option>
                                <option value="Base/Definitiva">Base/Definitiva (Propiedad)</option>
                                <option value="Interinato">Interinato</option>
                                <option value="Contrato">Contrato</option>
                                <option value="Por Honorarios">Por Honorarios</option>
                                <option value="Otro">Otro</option>
                            </select>
                            <div class="help-text">
                                Indique si cuenta con plaza base o el tipo de contrataci√≥n
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="horasContratacion">Horas de Contrataci√≥n <span class="required">*</span></label>
                            <select id="horasContratacion" name="horasContratacion" required>
                                <option value="">Seleccione...</option>
                                <option value="Tiempo Completo (40 hrs)">Tiempo Completo (40 hrs)</option>
                                <option value="3/4 de Tiempo (30 hrs)">3/4 de Tiempo (30 hrs)</option>
                                <option value="Medio Tiempo (20 hrs)">Medio Tiempo (20 hrs)</option>
                                <option value="Por Horas (menos de 20)">Por Horas (menos de 20)</option>
                                <option value="Otro">Otro</option>
                            </select>
                            <div class="help-text">
                                Horas semanales de contrataci√≥n en el IPN
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="correoInstitucional">Correo Electr√≥nico Institucional <span class="required">*</span></label>
                        <input type="email" id="correoInstitucional" name="correoInstitucional" required 
                               placeholder="ejemplo@ipn.mx">
                        <div class="help-text">
                            Ingrese su correo institucional del IPN
                        </div>
                    </div>

                    <div class="form-group">
                        <label>En caso de ser necesario, ¬øle gustar√≠a ser contactado por tel√©fono celular? <span class="required">*</span></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="aceptaContacto" value="Si" onclick="toggleTelefono(true)" required>
                                <span>S√≠, acepto ser contactado</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="aceptaContacto" value="No" onclick="toggleTelefono(false)" required>
                                <span>No deseo ser contactado</span>
                            </label>
                        </div>

                        <div class="conditional-field" id="telefonoFields">
                            <label for="telefonoCelular">N√∫mero de Tel√©fono Celular <span class="required">*</span></label>
                            <input type="tel" id="telefonoCelular" name="telefonoCelular" 
                                   placeholder="10 d√≠gitos (Ej: 5512345678)"
                                   pattern="[0-9]{10}"
                                   maxlength="10">
                            <div class="help-text">
                                Ingrese su n√∫mero celular a 10 d√≠gitos (sin espacios ni guiones)
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 2: Proyecto Vigente -->
                <div class="section">
                    <div class="section-title">
                        <span>üìä</span>
                        <span>Proyecto de Investigaci√≥n Vigente</span>
                    </div>

                    <div class="form-group">
                        <label>¬øCuenta actualmente con proyecto(s) de investigaci√≥n vigente(s)? <span class="required">*</span></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="tieneProyectoVigente" value="Si" onclick="toggleProyectoVigente(true)" required>
                                <span>S√≠</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="tieneProyectoVigente" value="No" onclick="toggleProyectoVigente(false)" required>
                                <span>No</span>
                            </label>
                        </div>

                        <div class="conditional-field" id="proyectoVigenteFields">
                            <div class="help-text" style="margin-bottom: 15px; padding: 12px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #D4AF37;">
                                <strong>üìå Importante:</strong> Puede tener proyectos de <strong>diferentes categor√≠as</strong> 
                                (ej: uno de Iniciaci√≥n + uno de Innovaci√≥n), pero <strong>solo UN proyecto por categor√≠a</strong>.<br>
                                <strong>üí° Consulte sus proyectos en:</strong> 
                                <a href="https://sappi.ipn.mx/" target="_blank" style="color: #6B1F3D; font-weight: 600;">
                                    SAPPI - Sistema de Administraci√≥n de Proyectos
                                </a>
                            </div>

                            <div id="proyectosListaContainer">
                                <!-- Proyectos se agregan din√°micamente aqu√≠ -->
                            </div>

                            <button type="button" class="btn-add" onclick="agregarProyecto()">
                                ‚ûï Agregar Proyecto
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 3: Beca EDI -->
                <div class="section">
                    <div class="section-title">
                        <span>üí∞</span>
                        <span>Beca EDI (Est√≠mulo al Desempe√±o de los Investigadores)</span>
                    </div>

                    <div class="form-group">
                        <label>¬øCuenta con Beca EDI? <span class="required">*</span></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="cuentaBecaEDI" value="Si" onclick="toggleEDI(true)" required>
                                <span>S√≠</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="cuentaBecaEDI" value="No" onclick="toggleEDI(false)" required>
                                <span>No</span>
                            </label>
                        </div>

                        <div class="conditional-field" id="ediFields">
                            <div class="form-group">
                            <label for="nivelEDI">Nivel EDI <span class="required">*</span></label>
                            <select id="nivelEDI" name="nivelEDI">
                                <option value="">Seleccione...</option>
                                <option value="Nivel 1">Nivel 1</option>
                                <option value="Nivel 2">Nivel 2</option>
                                <option value="Nivel 3">Nivel 3</option>
                                <option value="Nivel 4">Nivel 4</option>
                                <option value="Nivel 5">Nivel 5</option>
                                <option value="Nivel 6">Nivel 6</option>
                                <option value="Nivel 7">Nivel 7</option>
                                <option value="Nivel 8">Nivel 8</option>
                                <option value="Nivel Permanente">Nivel Permanente</option>
                            </select>
                                <div class="help-text">
                                    Seleccione el nivel de Est√≠mulo al Desempe√±o de los Investigadores
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="ediInicio">Fecha de Inicio <span class="required">*</span></label>
                                    <input type="date" id="ediInicio" name="ediInicio">
                                    <div class="help-text">
                                        Inicio de vigencia del per√≠odo actual
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="ediFinal">Fecha de T√©rmino <span class="required">*</span></label>
                                    <input type="date" id="ediFinal" name="ediFinal">
                                    <div class="help-text">
                                        Generalmente 2 a√±os despu√©s del inicio
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 4: SNII -->
                <div class="section">
                    <div class="section-title">
                        <span>üèÜ</span>
                        <span>Sistema Nacional de Investigadores (SNII)</span>
                    </div>

                    <div class="form-group">
                        <label>¬øCuenta con nombramiento SNII? <span class="required">*</span></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="cuentaSNII" value="Si" onclick="toggleSNII(true)" required>
                                <span>S√≠</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="cuentaSNII" value="No" onclick="toggleSNII(false)" required>
                                <span>No</span>
                            </label>
                        </div>

                        <div class="conditional-field" id="sniiFields">
                            <div class="form-group">
                                <label for="nivelSNII">Nivel SNII <span class="required">*</span></label>
                                <select id="nivelSNII" name="nivelSNII">
                                    <option value="">Seleccione...</option>
                                    <option value="Candidato">Candidato</option>
                                    <option value="Nivel I">Nivel I</option>
                                    <option value="Nivel II">Nivel II</option>
                                    <option value="Nivel III">Nivel III</option>
                                    <option value="Em√©rito">Em√©rito</option>
                                </select>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label for="sniiInicio">Fecha de Inicio <span class="required">*</span></label>
                                    <input type="date" id="sniiInicio" name="sniiInicio">
                                </div>

                                <div class="form-group">
                                    <label for="sniiFinal">Fecha de T√©rmino <span class="required">*</span></label>
                                    <input type="date" id="sniiFinal" name="sniiFinal">
                                </div>
                            </div>

                            <div class="form-group">
                                <label for="sniiConstancia">
                                    Constancia/Comprobante SNII <span class="required">*</span>
                                </label>
                                <input type="file" id="sniiConstancia" name="sniiConstancia" 
                                       accept=".pdf"
                                       style="padding: 8px;">
                                <div class="help-text">
                                    <strong>Adjunte su constancia o comprobante del nombramiento SNII</strong><br>
                                    <strong style="color: #6B1F3D;">Formato preferente: PDF</strong> (m√°x. 5 MB)
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 5: ORCID -->
                <div class="section">
                    <div class="section-title">
                        <span>üîó</span>
                        <span>Identificador ORCID</span>
                    </div>

                    <div class="form-group">
                        <label for="orcid">ORCID</label>
                        <input type="text" id="orcid" name="orcid" 
                               placeholder="0000-0000-0000-0000"
                               pattern="[0-9]{4}-[0-9]{4}-[0-9]{4}-[0-9]{3}[0-9X]">
                        <div class="help-text">
                            <strong>Formato:</strong> 0000-0000-0000-0000<br>
                            <strong style="color: #6B1F3D;">‚ö†Ô∏è Importante:</strong> El ORCID es un identificador √∫nico esencial para el registro y seguimiento de su productividad acad√©mica.<br>
                            <strong>Si no tiene ORCID, reg√≠strese gratuitamente en:</strong> 
                            <a href="https://orcid.org/register" target="_blank" style="color: #2563eb; font-weight: 600;">
                                https://orcid.org/register
                            </a> (solo toma 30 segundos)
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 6: Redes de Investigaci√≥n IPN -->
                <div class="section">
                    <div class="section-title">
                        <span>üåê</span>
                        <span>Redes de Investigaci√≥n IPN (CORIyP)</span>
                    </div>

                    <div class="form-group">
                        <label>¬øParticipa en alguna Red de Investigaci√≥n del IPN? <span class="required">*</span></label>
                        <div class="radio-group">
                            <label class="radio-label">
                                <input type="radio" name="participaRedes" value="Si" onclick="toggleRedes(true)" required>
                                <span>S√≠</span>
                            </label>
                            <label class="radio-label">
                                <input type="radio" name="participaRedes" value="No" onclick="toggleRedes(false)" required>
                                <span>No</span>
                            </label>
                        </div>

                        <!-- Mensaje informativo cuando NO participa -->
                        <div class="conditional-field" id="noRedesInfo" style="display: none;">
                            <div style="padding: 20px; background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%); border-radius: 10px; border-left: 6px solid #2196F3; box-shadow: 0 2px 8px rgba(33, 150, 243, 0.2);">
                                <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                                    <span style="font-size: 2rem;">‚ÑπÔ∏è</span>
                                    <strong style="font-size: 1.1rem; color: #1565c0;">¬øInteresado en participar en una Red de Investigaci√≥n?</strong>
                                </div>
                                <p style="color: #1565c0; line-height: 1.8; margin-bottom: 12px;">
                                    Las <strong>Redes de Investigaci√≥n y Posgrado del IPN</strong> re√∫nen a m√°s de <strong>1000 investigadores</strong> trabajando en colaboraci√≥n en 12 redes especializadas.
                                </p>
                                <p style="color: #1565c0; line-height: 1.8; margin-bottom: 12px;">
                                    <strong>üåê Conozca m√°s sobre las redes en:</strong><br>
                                    <a href="https://www.ipn.mx/coriyp/" target="_blank" 
                                       style="color: #0d47a1; font-weight: 600; font-size: 1.05rem; text-decoration: none; border-bottom: 2px solid #0d47a1;">
                                        www.ipn.mx/coriyp
                                    </a>
                                </p>
                                <div style="background: #fff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                    <p style="color: #1565c0; line-height: 1.8; margin: 0;">
                                        <strong>üìû Para m√°s informaci√≥n o dudas, comun√≠quese con:</strong><br>
                                        <strong>Departamento de Investigaci√≥n - UPIIZ</strong><br>
                                        üìß <a href="mailto:investigacion_UPIIZ@ipn.mx" style="color: #0d47a1; font-weight: 600;">investigacion_UPIIZ@ipn.mx</a><br>
                                        üì± Cel. 492 250 4428 ‚Ä¢ Ext: 83530<br>
                                        üë§ M. en C. Rafael Reveles Mart√≠nez
                                    </p>
                                </div>
                            </div>
                        </div>

                        <div class="conditional-field" id="redesFields">
                            <div class="help-text" style="margin-bottom: 20px; padding: 12px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196F3;">
                                <strong>üìå Informaci√≥n:</strong> Las Redes de Investigaci√≥n y Posgrado del IPN est√°n coordinadas por la CORIyP.<br>
                                Puede seleccionar hasta <strong>2 redes</strong> en las que participe actualmente.<br>
                                <strong>üí° Consulte m√°s informaci√≥n en:</strong> 
                                <a href="https://www.ipn.mx/coriyp/" target="_blank" style="color: #1976d2; font-weight: 600;">
                                    www.ipn.mx/coriyp
                                </a>
                            </div>

                            <!-- Red 1 -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #e0e0e0; margin-bottom: 20px;">
                                <h4 style="color: #6B1F3D; margin-bottom: 15px;">Red de Investigaci√≥n 1 <span class="required">*</span></h4>
                                
                                <div class="form-group">
                                    <label for="red1Nombre">Nombre de la Red <span class="required">*</span></label>
                                    <select id="red1Nombre" name="red1Nombre">
                                        <option value="">Seleccione una red...</option>
                                        <optgroup label="üî¨ Redes de Investigaci√≥n (REI)">
                                            <option value="REI01-REMA">REI01-REMA | Red de Medio Ambiente</option>
                                            <option value="REI02-RBIO">REI02-RBIO | Red de Biotecnolog√≠a</option>
                                            <option value="REI03-RNMN">REI03-RNMN | Red de Nanociencia y Micro-nanotecnolog√≠a</option>
                                            <option value="REI04-RCOM">REI04-RCOM | Red de Computaci√≥n</option>
                                            <option value="REI05-RNER">REI05-RNER | Red de Energ√≠a</option>
                                            <option value="REI06-RSAL">REI06-RSAL | Red de Salud</option>
                                            <option value="REI07-RDEC">REI07-RDEC | Red de Desarrollo Econ√≥mico</option>
                                            <option value="REI08-RIAC">REI08-RIAC | Red de Inteligencia Artificial y Ciencia de Datos</option>
                                        </optgroup>
                                        <optgroup label="üë• Redes de Expertos (REX)">
                                            <option value="REX01-RXTC">REX01-RXTC | Red de Expertos en Telecomunicaciones</option>
                                            <option value="REX02-RXRM">REX02-RXRM | Red de Expertos en Rob√≥tica y Mecatr√≥nica</option>
                                            <option value="REX03-RXSC">REX03-RXSC | Red de Expertos en Sistemas Complejos</option>
                                            <option value="REX04-RXAU">REX04-RXAU | Red de Expertos en Innovaci√≥n Automotriz</option>
                                        </optgroup>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="red1Rol">Rol en la Red <span class="required">*</span></label>
                                    <select id="red1Rol" name="red1Rol">
                                        <option value="">Seleccione...</option>
                                        <option value="Coordinador">Coordinador/a</option>
                                        <option value="Integrante">Integrante</option>
                                        <option value="Colaborador">Colaborador/a</option>
                                    </select>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="red1Inicio">Fecha de Inicio <span class="required">*</span></label>
                                        <input type="date" id="red1Inicio" name="red1Inicio">
                                        <div class="help-text">
                                            Inicio de participaci√≥n en la red
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="red1Termino">Fecha de T√©rmino</label>
                                        <input type="date" id="red1Termino" name="red1Termino">
                                        <div class="help-text">
                                            Dejar vac√≠o si a√∫n participa (vigente)
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="red1Constancia">
                                        Constancia de Participaci√≥n
                                    </label>
                                    <input type="file" id="red1Constancia" name="red1Constancia" 
                                           accept=".pdf"
                                           style="padding: 8px;">
                                    <div class="help-text">
                                        Adjunte constancia oficial de participaci√≥n (opcional, PDF m√°x. 5 MB)
                                    </div>
                                </div>
                            </div>

                            <!-- Red 2 (Opcional) -->
                            <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #e0e0e0;">
                                <h4 style="color: #6B1F3D; margin-bottom: 15px;">Red de Investigaci√≥n 2 (Opcional)</h4>
                                
                                <div class="form-group">
                                    <label for="red2Nombre">Nombre de la Red</label>
                                    <select id="red2Nombre" name="red2Nombre">
                                        <option value="">Seleccione una red...</option>
                                        <optgroup label="üî¨ Redes de Investigaci√≥n (REI)">
                                            <option value="REI01-REMA">REI01-REMA | Red de Medio Ambiente</option>
                                            <option value="REI02-RBIO">REI02-RBIO | Red de Biotecnolog√≠a</option>
                                            <option value="REI03-RNMN">REI03-RNMN | Red de Nanociencia y Micro-nanotecnolog√≠a</option>
                                            <option value="REI04-RCOM">REI04-RCOM | Red de Computaci√≥n</option>
                                            <option value="REI05-RNER">REI05-RNER | Red de Energ√≠a</option>
                                            <option value="REI06-RSAL">REI06-RSAL | Red de Salud</option>
                                            <option value="REI07-RDEC">REI07-RDEC | Red de Desarrollo Econ√≥mico</option>
                                            <option value="REI08-RIAC">REI08-RIAC | Red de Inteligencia Artificial y Ciencia de Datos</option>
                                        </optgroup>
                                        <optgroup label="üë• Redes de Expertos (REX)">
                                            <option value="REX01-RXTC">REX01-RXTC | Red de Expertos en Telecomunicaciones</option>
                                            <option value="REX02-RXRM">REX02-RXRM | Red de Expertos en Rob√≥tica y Mecatr√≥nica</option>
                                            <option value="REX03-RXSC">REX03-RXSC | Red de Expertos en Sistemas Complejos</option>
                                            <option value="REX04-RXAU">REX04-RXAU | Red de Expertos en Innovaci√≥n Automotriz</option>
                                        </optgroup>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label for="red2Rol">Rol en la Red</label>
                                    <select id="red2Rol" name="red2Rol">
                                        <option value="">Seleccione...</option>
                                        <option value="Coordinador">Coordinador/a</option>
                                        <option value="Integrante">Integrante</option>
                                        <option value="Colaborador">Colaborador/a</option>
                                    </select>
                                </div>

                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="red2Inicio">Fecha de Inicio</label>
                                        <input type="date" id="red2Inicio" name="red2Inicio">
                                        <div class="help-text">
                                            Inicio de participaci√≥n en la red
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="red2Termino">Fecha de T√©rmino</label>
                                        <input type="date" id="red2Termino" name="red2Termino">
                                        <div class="help-text">
                                            Dejar vac√≠o si a√∫n participa (vigente)
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="red2Constancia">
                                        Constancia de Participaci√≥n
                                    </label>
                                    <input type="file" id="red2Constancia" name="red2Constancia" 
                                           accept=".pdf"
                                           style="padding: 8px;">
                                    <div class="help-text">
                                        Adjunte constancia oficial de participaci√≥n (opcional, PDF m√°x. 5 MB)
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Secci√≥n 7: L√≠neas de Investigaci√≥n -->
                <div class="section">
                    <div class="section-title">
                        <span>üî¨</span>
                        <span>L√≠neas de Generaci√≥n y Aplicaci√≥n del Conocimiento</span>
                    </div>

                    <div class="form-group">
                        <label>
                            Mencione al menos 3 l√≠neas de generaci√≥n y aplicaci√≥n del conocimiento que maneje 
                            y en las que haya trabajado en los √∫ltimos 3 a√±os <span class="required">*</span>
                        </label>
                        <div class="help-text" style="margin-bottom: 15px;">
                            Agregue entre 3 y 5 l√≠neas de investigaci√≥n principales
                        </div>

                        <div id="lineasContainer">
                            <div class="line-item">
                                <input type="text" name="linea1" placeholder="L√≠nea de investigaci√≥n 1" required>
                            </div>
                            <div class="line-item">
                                <input type="text" name="linea2" placeholder="L√≠nea de investigaci√≥n 2" required>
                            </div>
                            <div class="line-item">
                                <input type="text" name="linea3" placeholder="L√≠nea de investigaci√≥n 3" required>
                            </div>
                        </div>

                        <button type="button" class="btn-add" onclick="agregarLinea()">
                            ‚ûï Agregar otra l√≠nea
                        </button>
                    </div>
                </div>

                <!-- Secci√≥n 8: Productividad Acad√©mica 2025 -->
                <div class="section">
                    <div class="section-title">
                        <span>üìÑ</span>
                        <span>Publicaciones Cient√≠ficas 2025 (con DOI)</span>
                    </div>

                    <div class="form-group">
                        <label>
                            DOI de Publicaciones 2025
                        </label>
                        <div class="help-text" style="margin-bottom: 15px; padding: 12px; background: #e3f2fd; border-radius: 8px; border-left: 4px solid #2196F3;">
                            <strong>üìå Solo publicaciones con DOI (Digital Object Identifier)</strong><br>
                            Agregue todas sus publicaciones cient√≠ficas de 2025 que cuenten con DOI.<br>
                            <strong>üí° Incluye:</strong> Art√≠culos, libros, cap√≠tulos de libro, proceedings de conferencias, preprints con DOI.<br>
                            Si no tiene publicaciones a√∫n en 2025, puede dejar esta secci√≥n vac√≠a.
                        </div>

                        <div id="doisContainer">
                            <div class="line-item" style="display: grid; grid-template-columns: 1fr 2fr auto; gap: 10px; align-items: center;">
                                <select name="tipoDoi1" style="min-width: 180px;">
                                    <option value="">Tipo de publicaci√≥n...</option>
                                    <option value="Art√≠culo de revista">Art√≠culo de revista</option>
                                    <option value="Proceedings">Proceedings de conferencia</option>
                                    <option value="Cap√≠tulo de libro">Cap√≠tulo de libro</option>
                                    <option value="Libro completo">Libro completo</option>
                                    <option value="Preprint">Preprint (arXiv, bioRxiv, etc.)</option>
                                    <option value="Dataset">Dataset cient√≠fico</option>
                                    <option value="Otra publicaci√≥n con DOI">Otra publicaci√≥n con DOI</option>
                                </select>
                                <input type="text" name="doi1" placeholder="DOI (Ej: 10.1234/revista.2025.001)">
                            </div>
                        </div>

                        <button type="button" class="btn-add" onclick="agregarDoi()">
                            ‚ûï Agregar otra publicaci√≥n
                        </button>
                    </div>

                    <div class="help-text" style="margin-top: 10px; padding: 15px; background: #e3f2fd; border-radius: 8px;">
                        <strong>üí° Nota:</strong> El DOI (Digital Object Identifier) es el identificador √∫nico de su publicaci√≥n. 
                        Ejemplo de formato: 10.1234/nombre.revista.2025.001
                    </div>

                    <div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #fff3cd 0%, #ffe8a1 100%); border-radius: 10px; border-left: 6px solid #ffc107; box-shadow: 0 2px 8px rgba(255, 193, 7, 0.2);">
                        <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 10px;">
                            <span style="font-size: 2rem;">üì¢</span>
                            <strong style="font-size: 1.2rem; color: #856404;">Aviso Importante</strong>
                        </div>
                        <p style="color: #856404; line-height: 1.8; margin: 0;">
                            <strong>En el transcurso de los pr√≥ximos d√≠as</strong>, se les solicitar√° completar informaci√≥n adicional sobre su productividad acad√©mica general <strong>una vez asignado su usuario y contrase√±a</strong> al <strong>Sistema de Gesti√≥n de Informaci√≥n del Departamento de Investigaci√≥n de UPIIZ</strong>, incluyendo:
                        </p>
                        <ul style="color: #856404; margin-top: 10px; margin-bottom: 0; padding-left: 25px; line-height: 1.8;">
                            <li><strong>Direcci√≥n de tesis</strong> (Licenciatura, Maestr√≠a, Doctorado)</li>
                            <li><strong>Ponencias y participaci√≥n en congresos</strong></li>
                            <li><strong>Patentes y propiedad intelectual</strong></li>
                            <li><strong>Estancias de investigaci√≥n</strong></li>
                            <li><strong>Premios y reconocimientos acad√©micos</strong></li>
                            <li><strong>Otros productos acad√©micos</strong></li>
                        </ul>
                        <p style="color: #856404; margin-top: 12px; margin-bottom: 0;">
                            Por ahora, <strong>solo registre sus publicaciones con DOI de 2025</strong>. Se le notificar√° por correo electr√≥nico cuando est√© disponible su acceso al sistema extendido.
                        </p>
                    </div>
                </div>

                <!-- Secci√≥n 9: Sugerencias y Comentarios -->
                <div class="section">
                    <div class="section-title">
                        <span>üí¨</span>
                        <span>Sugerencias y Comentarios</span>
                    </div>

                    <div class="form-group">
                        <label for="sugerencias">
                            ¬øTiene alguna sugerencia, comentario o informaci√≥n adicional que desee compartir?
                        </label>
                        <textarea id="sugerencias" name="sugerencias" 
                                  placeholder="Escriba aqu√≠ sus sugerencias, comentarios o cualquier informaci√≥n adicional que considere relevante para el Departamento de Investigaci√≥n..."
                                  rows="5"
                                  style="resize: vertical; min-height: 120px;"></textarea>
                        <div class="help-text">
                            <strong>Opcional:</strong> Este espacio es para que pueda compartir cualquier informaci√≥n adicional, sugerencias para mejorar el proceso de registro, o comentarios sobre su participaci√≥n en actividades de investigaci√≥n.
                        </div>
                    </div>
                </div>

                <!-- Bot√≥n de Env√≠o -->
                <div class="submit-container">
                    <button type="submit" class="btn-submit">
                        ‚úì Enviar Formulario
                    </button>
                </div>
            </form>
        </div>

        <div class="footer">
            <p style="font-size: 0.9rem; line-height: 1.6;">
                Calle Circuito Cerro del Gato No. 202, Col. Ciudad Administrativa, Zacatecas, Zac. C.P. 98160
            </p>
            <p style="margin-top: 8px; font-size: 0.9rem;">
                Conmutador: 55 57 29 60 00
            </p>
            <p style="margin-top: 5px; font-size: 0.9rem;">
                Correo: <a href="mailto:zacatecas@ipn.mx" style="color: #D4AF37; text-decoration: none; font-weight: 600;">zacatecas@ipn.mx</a>
            </p>
        </div>
    </div>

    <script>
        let lineaCount = 3;
        let doiCount = 1;
        let proyectoCount = 0;
        let categoriasUsadas = new Set();

        // Validador de CURP en tiempo real
        document.addEventListener('DOMContentLoaded', function() {
            const curpInput = document.getElementById('curp');
            
            curpInput.addEventListener('input', function(e) {
                // Convertir a may√∫sculas autom√°ticamente
                this.value = this.value.toUpperCase();
                
                // Validar formato b√°sico
                if (this.value.length === 18) {
                    const curpPattern = /^[A-Z]{4}[0-9]{6}[HM][A-Z]{5}[0-9A-Z][0-9]$/;
                    if (curpPattern.test(this.value)) {
                        this.style.borderColor = '#28a745';
                    } else {
                        this.style.borderColor = '#dc3545';
                    }
                } else if (this.value.length > 0) {
                    this.style.borderColor = '#ffc107';
                } else {
                    this.style.borderColor = '#e0e0e0';
                }
            });

            // Validador de tama√±o de archivo SNII
            const sniiConstanciaInput = document.getElementById('sniiConstancia');
            
            sniiConstanciaInput.addEventListener('change', function(e) {
                const archivo = this.files[0];
                if (archivo) {
                    const tama√±oMB = archivo.size / (1024 * 1024);
                    
                    if (tama√±oMB > 5) {
                        alert(`El archivo es demasiado grande (${tama√±oMB.toFixed(2)} MB). El tama√±o m√°ximo permitido es 5 MB.`);
                        this.value = '';
                        this.style.borderColor = '#dc3545';
                    } else {
                        this.style.borderColor = '#28a745';
                    }
                }
            });

            // Validador de tel√©fono celular en tiempo real
            const telefonoInput = document.getElementById('telefonoCelular');
            
            telefonoInput.addEventListener('input', function(e) {
                // Solo permitir n√∫meros
                this.value = this.value.replace(/[^0-9]/g, '');
                
                // Validar longitud
                if (this.value.length === 10) {
                    this.style.borderColor = '#28a745';
                } else if (this.value.length > 0) {
                    this.style.borderColor = '#ffc107';
                } else {
                    this.style.borderColor = '#e0e0e0';
                }
            });
        });

        function toggleTelefono(show) {
            const telefonoFields = document.getElementById('telefonoFields');
            const telefonoCelular = document.getElementById('telefonoCelular');
            
            if (show) {
                telefonoFields.classList.add('active');
                telefonoCelular.required = true;
            } else {
                telefonoFields.classList.remove('active');
                telefonoCelular.required = false;
                telefonoCelular.value = '';
            }
        }

        function toggleProyectoVigente(show) {
            const proyectoVigenteFields = document.getElementById('proyectoVigenteFields');
            
            if (show) {
                proyectoVigenteFields.classList.add('active');
            } else {
                proyectoVigenteFields.classList.remove('active');
                // Limpiar proyectos agregados
                document.getElementById('proyectosListaContainer').innerHTML = '';
                proyectoCount = 0;
                categoriasUsadas.clear();
            }
        }

        function agregarProyecto() {
            proyectoCount++;
            const container = document.getElementById('proyectosListaContainer');
            
            const div = document.createElement('div');
            div.id = `proyecto_${proyectoCount}`;
            div.style.marginBottom = '20px';
            div.style.padding = '20px';
            div.style.background = '#f8f9fa';
            div.style.borderRadius = '8px';
            div.style.border = '2px solid #e0e0e0';
            
            div.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="margin: 0; color: #6B1F3D;">Proyecto ${proyectoCount}</h4>
                    <button type="button" class="btn-remove" onclick="removerProyecto(${proyectoCount})">‚úï Eliminar</button>
                </div>

                <div class="form-group">
                    <label>Tipo de Financiamiento <span class="required">*</span></label>
                    <select id="financiamiento_${proyectoCount}" name="proyectos[${proyectoCount}][financiamiento]" 
                            onchange="toggleTipoFinanciamiento(${proyectoCount})" required>
                        <option value="">Seleccione...</option>
                        <option value="Interno IPN">Financiamiento Interno IPN</option>
                        <option value="Externo">Financiamiento Externo</option>
                    </select>
                    <div class="help-text">
                        Seleccione la fuente principal de financiamiento del proyecto
                    </div>
                </div>

                <!-- Campos para Financiamiento INTERNO -->
                <div id="camposInterno_${proyectoCount}" style="display: none;">
                <div class="form-group">
                    <label>Categor√≠a <span class="required">*</span></label>
                    <select id="categoria_${proyectoCount}" name="proyectos[${proyectoCount}][categoria]" 
                                onchange="actualizarTiposProyecto(${proyectoCount})">
                        <option value="">Seleccione categor√≠a...</option>
                        <option value="Iniciaci√≥n">Iniciaci√≥n en la investigaci√≥n</option>
                        <option value="Colaborativos">Grupos colaborativos</option>
                        <option value="Innovaci√≥n">Innovaci√≥n y maduraci√≥n tecnol√≥gica</option>
                        <option value="Estrat√©gicos">Proyectos estrat√©gicos</option>
                        <option value="Consorcios">Consorcios</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Tipo <span class="required">*</span></label>
                        <select id="tipo_${proyectoCount}" name="proyectos[${proyectoCount}][tipo]">
                            <option value="">Primero seleccione categor√≠a...</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Clave SIP <span class="required">*</span></label>
                        <input type="text" id="claveSIP_interno_${proyectoCount}" name="proyectos[${proyectoCount}][claveSIP]" 
                               placeholder="Ej: SIP-20250123" 
                               style="text-transform: uppercase;">
                        <div class="help-text">
                            Clave del Sistema de Administraci√≥n de Proyectos (SAPPI)
                        </div>
                    </div>
                </div>

                <!-- Campos para Financiamiento EXTERNO -->
                <div id="camposExterno_${proyectoCount}" style="display: none;">
                    <div class="conditional-field" style="margin-left: 0; padding: 15px; background: #fff3cd; border-radius: 8px; margin-bottom: 15px;">
                        <div class="form-group">
                            <label>Fuente de Financiamiento Externo <span class="required">*</span></label>
                            <select id="fuenteExterna_select_${proyectoCount}" name="proyectos[${proyectoCount}][fuenteExterna]">
                                <option value="">Seleccione la fuente...</option>
                                <option value="SECIHTI">SECIHTI (Secretar√≠a de Ciencia, Humanidades, Tecnolog√≠a e Innovaci√≥n)</option>
                                <option value="SECTEI">SECTEI (Secretar√≠a de Ciencia, Tecnolog√≠a e Innovaci√≥n CDMX)</option>
                                <option value="European Commission">European Commission (Comisi√≥n Europea)</option>
                                <option value="Wellcome Foundation">Wellcome Foundation (Fundaci√≥n Wellcome)</option>
                                <option value="SAM.GOV">SAM.GOV (Subvenciones Federales EE.UU.)</option>
                                <option value="GCRF">GCRF (Global Challenges Research Fund)</option>
                                <option value="NIH">NIH (National Institutes of Health)</option>
                                <option value="Otra fuente internacional">Otra fuente internacional</option>
                                <option value="Empresa privada">Empresa privada</option>
                                <option value="ONG/Fundaci√≥n">ONG/Fundaci√≥n</option>
                            </select>
                            <div class="help-text">
                                Para m√°s informaci√≥n: <a href="https://www.ipn.mx/investigacion/convocatorias/externos.html" target="_blank" style="color: #856404; font-weight: 600;">Proyectos Externos IPN</a>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Categor√≠a <span class="required">*</span></label>
                        <select id="categoriaExt_${proyectoCount}" name="proyectos[${proyectoCount}][categoriaExterna]" 
                                onchange="actualizarTiposProyectoExterno(${proyectoCount})">
                            <option value="">Seleccione categor√≠a...</option>
                        <option value="Externos">Externos al IPN</option>
                            <option value="Consorcios">Consorcios Internacionales</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Tipo <span class="required">*</span></label>
                        <select id="tipoExt_${proyectoCount}" name="proyectos[${proyectoCount}][tipoExterno]">
                        <option value="">Primero seleccione categor√≠a...</option>
                    </select>
                    </div>

                    <div class="form-group">
                        <label>Descripci√≥n del Proyecto</label>
                        <textarea id="descripcionExterno_${proyectoCount}" name="proyectos[${proyectoCount}][descripcionExterno]" 
                                  placeholder="Descripci√≥n breve del proyecto externo (opcional)..." 
                                  rows="3"></textarea>
                        <div class="help-text">
                            Opcional: Describa brevemente el proyecto
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 8px;">
                            <input type="checkbox" id="tieneClaveSIP_${proyectoCount}" 
                                   onclick="toggleClaveSIPExterno(${proyectoCount})"
                                   style="width: auto; height: auto;">
                            <span>¬øEste proyecto tiene Clave SIP del IPN?</span>
                        </label>
                        <div class="help-text">
                            Marque solo si el proyecto externo fue registrado en SAPPI del IPN
                        </div>
                        
                        <div id="claveSIPExterno_${proyectoCount}" style="display: none; margin-top: 15px;">
                            <label>Clave SIP</label>
                            <input type="text" id="claveSIP_externo_${proyectoCount}" name="proyectos[${proyectoCount}][claveSIPExterna]" 
                                   placeholder="Ej: EXT-2025-123" 
                                   style="text-transform: uppercase;">
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Nombre del Proyecto <span class="required">*</span></label>
                    <input type="text" name="proyectos[${proyectoCount}][nombre]" 
                           placeholder="Ingrese el nombre completo del proyecto" required>
                    <div class="help-text">
                        Si no recuerda el nombre, cons√∫ltelo en: 
                        <a href="https://sappi.ipn.mx/" target="_blank" style="color: #2563eb; font-weight: 600;">
                            SAPPI (Sistema de Administraci√≥n de Proyectos)
                        </a>
                    </div>
                </div>
            `;
            
            container.appendChild(div);
        }

        function removerProyecto(id) {
            const elemento = document.getElementById(`proyecto_${id}`);
            
            // Obtener categor√≠a antes de eliminar
            const selectCategoria = document.getElementById(`categoria_${id}`);
            if (selectCategoria && selectCategoria.value) {
                categoriasUsadas.delete(selectCategoria.value);
            }
            
            elemento.remove();
            proyectoCount--;
        }

        function toggleClaveSIPExterno(proyectoId) {
            const checkbox = document.getElementById(`tieneClaveSIP_${proyectoId}`);
            const claveSIPDiv = document.getElementById(`claveSIPExterno_${proyectoId}`);
            
            if (checkbox.checked) {
                claveSIPDiv.style.display = 'block';
            } else {
                claveSIPDiv.style.display = 'none';
                document.getElementById(`claveSIP_externo_${proyectoId}`).value = '';
            }
        }

        function toggleTipoFinanciamiento(proyectoId) {
            const financiamiento = document.getElementById(`financiamiento_${proyectoId}`).value;
            const camposInterno = document.getElementById(`camposInterno_${proyectoId}`);
            const camposExterno = document.getElementById(`camposExterno_${proyectoId}`);
            
            // Elementos de campos internos
            const categoria = document.getElementById(`categoria_${proyectoId}`);
            const tipo = document.getElementById(`tipo_${proyectoId}`);
            const claveSIPInterno = document.getElementById(`claveSIP_interno_${proyectoId}`);
            
            // Elementos de campos externos
            const fuenteExterna = document.getElementById(`fuenteExterna_select_${proyectoId}`);
            const categoriaExt = document.getElementById(`categoriaExt_${proyectoId}`);
            const tipoExt = document.getElementById(`tipoExt_${proyectoId}`);
            
            if (financiamiento === 'Interno IPN') {
                // Mostrar campos internos, ocultar externos
                camposInterno.style.display = 'block';
                camposExterno.style.display = 'none';
                
                categoria.required = true;
                tipo.required = true;
                claveSIPInterno.required = true;
                fuenteExterna.required = false;
                categoriaExt.required = false;
                tipoExt.required = false;
                
                // Limpiar campos externos
                fuenteExterna.value = '';
                categoriaExt.value = '';
                tipoExt.value = '';
                
            } else if (financiamiento === 'Externo') {
                // Mostrar campos externos, ocultar internos
                camposInterno.style.display = 'none';
                camposExterno.style.display = 'block';
                
                categoria.required = false;
                tipo.required = false;
                claveSIPInterno.required = false;
                fuenteExterna.required = true;
                categoriaExt.required = true;
                tipoExt.required = true;
                
                // Limpiar campos internos
                categoria.value = '';
                tipo.value = '';
                claveSIPInterno.value = '';
                
            } else {
                // No ha seleccionado nada
                camposInterno.style.display = 'none';
                camposExterno.style.display = 'none';
            }
        }

        function actualizarTiposProyectoExterno(proyectoId) {
            const categoria = document.getElementById(`categoriaExt_${proyectoId}`).value;
            const tipoSelect = document.getElementById(`tipoExt_${proyectoId}`);
            
            // Tipos para proyectos EXTERNOS
            const tiposPorCategoriaExterna = {
                'Externos': [
                    'SECIHTI - Ciencia Frontera',
                    'SECIHTI - Investigaci√≥n Cient√≠fica B√°sica',
                    'SECIHTI - PRONACES',
                    'SECIHTI - Otros',
                    'SENER',
                    'Fundaci√≥n/ONG',
                    'Empresa privada',
                    'Universidad extranjera',
                    'Otro proyecto externo'
                ],
                'Consorcios': [
                    'Consorcio Internacional',
                    'Colaboraci√≥n bilateral',
                    'Proyecto multinacional',
                    'Red internacional',
                    'Otro consorcio'
                ]
            };
            
            // Limpiar y agregar opciones
            tipoSelect.innerHTML = '<option value="">Seleccione tipo...</option>';
            
            if (categoria && tiposPorCategoriaExterna[categoria]) {
                tiposPorCategoriaExterna[categoria].forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo;
                    option.textContent = tipo;
                    tipoSelect.appendChild(option);
                });
            }
        }

        function actualizarTiposProyecto(proyectoId) {
            const categoria = document.getElementById(`categoria_${proyectoId}`).value;
            const tipoSelect = document.getElementById(`tipo_${proyectoId}`);
            
            // Validar que no haya otra categor√≠a igual
            const selectsCategoria = document.querySelectorAll('[id^="categoria_"]');
            let categoriaRepetida = false;
            
            selectsCategoria.forEach(select => {
                if (select.id !== `categoria_${proyectoId}` && select.value === categoria && categoria !== '') {
                    categoriaRepetida = true;
                }
            });
            
            if (categoriaRepetida) {
                alert(`Ya tiene un proyecto de la categor√≠a "${categoria}". Solo puede tener un proyecto por categor√≠a.`);
                document.getElementById(`categoria_${proyectoId}`).value = '';
                tipoSelect.innerHTML = '<option value="">Primero seleccione categor√≠a...</option>';
                return;
            }
            
            // Definir tipos seg√∫n categor√≠a (basado en https://www.ipn.mx/investigacion/convocatorias/proyectos.html)
            const tiposPorCategoria = {
                'Iniciaci√≥n': [
                    'Iniciaci√≥n',
                    'Individuales',
                    'Especiales (Programa Especial de Consolidaci√≥n)'
                ],
                'Colaborativos': [
                    'Multidisciplinarios',
                    'Transdisciplinarios',
                    'PRORED (Proyectos en Red)'
                ],
                'Innovaci√≥n': [
                    'Desarrollo Tecnol√≥gico - Alumnos',
                    'Desarrollo Tecnol√≥gico - Profesores',
                    'Innovaci√≥n - Alumnos',
                    'Innovaci√≥n - Profesores'
                ],
                'Estrat√©gicos': [
                    'Impacto Cient√≠fico y Tecnol√≥gico',
                    'Alianzas Internacionales',
                    'Inter√©s Estrat√©gico Institucional'
                ],
                'Consorcios': [
                    'IPN - BUAP',
                    'IPN - UAM - UAEM√âX',
                    'IPN - UAM INNOVA METRO - POLITEC',
                    'Otro Consorcio Nacional',
                    'Consorcio Internacional'
                ]
            };
            
            // Limpiar y agregar opciones
            tipoSelect.innerHTML = '<option value="">Seleccione tipo...</option>';
            
            if (categoria && tiposPorCategoria[categoria]) {
                tiposPorCategoria[categoria].forEach(tipo => {
                    const option = document.createElement('option');
                    option.value = tipo;
                    option.textContent = tipo;
                    tipoSelect.appendChild(option);
                });
            }
        }

        function toggleEDI(show) {
            const ediFields = document.getElementById('ediFields');
            const nivelEDI = document.getElementById('nivelEDI');
            const ediInicio = document.getElementById('ediInicio');
            const ediFinal = document.getElementById('ediFinal');
            
            if (show) {
                ediFields.classList.add('active');
                nivelEDI.required = true;
                ediInicio.required = true;
                ediFinal.required = true;
            } else {
                ediFields.classList.remove('active');
                nivelEDI.required = false;
                ediInicio.required = false;
                ediFinal.required = false;
                nivelEDI.value = '';
                ediInicio.value = '';
                ediFinal.value = '';
            }
        }

        function toggleSNII(show) {
            const sniiFields = document.getElementById('sniiFields');
            const nivelSNII = document.getElementById('nivelSNII');
            const sniiInicio = document.getElementById('sniiInicio');
            const sniiFinal = document.getElementById('sniiFinal');
            const sniiConstancia = document.getElementById('sniiConstancia');
            
            if (show) {
                sniiFields.classList.add('active');
                nivelSNII.required = true;
                sniiInicio.required = true;
                sniiFinal.required = true;
                sniiConstancia.required = true;
            } else {
                sniiFields.classList.remove('active');
                nivelSNII.required = false;
                sniiInicio.required = false;
                sniiFinal.required = false;
                sniiConstancia.required = false;
                nivelSNII.value = '';
                sniiInicio.value = '';
                sniiFinal.value = '';
                sniiConstancia.value = '';
            }
        }

        function toggleRedes(show) {
            const redesFields = document.getElementById('redesFields');
            const noRedesInfo = document.getElementById('noRedesInfo');
            const red1Nombre = document.getElementById('red1Nombre');
            const red1Rol = document.getElementById('red1Rol');
            const red1Inicio = document.getElementById('red1Inicio');
            
            if (show) {
                // Mostrar campos de redes, ocultar info
                redesFields.classList.add('active');
                noRedesInfo.style.display = 'none';
                red1Nombre.required = true;
                red1Rol.required = true;
                red1Inicio.required = true;
            } else {
                // Ocultar campos de redes, mostrar info
                redesFields.classList.remove('active');
                noRedesInfo.style.display = 'block';
                red1Nombre.required = false;
                red1Rol.required = false;
                red1Inicio.required = false;
                // Limpiar campos Red 1
                red1Nombre.value = '';
                red1Rol.value = '';
                red1Inicio.value = '';
                document.getElementById('red1Termino').value = '';
                document.getElementById('red1Constancia').value = '';
                // Limpiar campos Red 2
                document.getElementById('red2Nombre').value = '';
                document.getElementById('red2Rol').value = '';
                document.getElementById('red2Inicio').value = '';
                document.getElementById('red2Termino').value = '';
                document.getElementById('red2Constancia').value = '';
            }
        }

        function agregarLinea() {
            if (lineaCount >= 5) {
                alert('M√°ximo 5 l√≠neas de investigaci√≥n');
                return;
            }

            lineaCount++;
            const container = document.getElementById('lineasContainer');
            const div = document.createElement('div');
            div.className = 'line-item';
            div.innerHTML = `
                <input type="text" name="linea${lineaCount}" placeholder="L√≠nea de investigaci√≥n ${lineaCount}">
                <button type="button" class="btn-remove" onclick="removerLinea(this)">‚úï</button>
            `;
            container.appendChild(div);
        }

        function removerLinea(button) {
            button.parentElement.remove();
            lineaCount--;
        }

        function agregarDoi() {
            if (doiCount >= 20) {
                alert('M√°ximo 20 publicaciones');
                return;
            }

            doiCount++;
            const container = document.getElementById('doisContainer');
            const div = document.createElement('div');
            div.className = 'line-item';
            div.style.display = 'grid';
            div.style.gridTemplateColumns = '1fr 2fr auto';
            div.style.gap = '10px';
            div.style.alignItems = 'center';
            div.innerHTML = `
                <select name="tipoDoi${doiCount}" style="min-width: 180px;">
                    <option value="">Tipo de publicaci√≥n...</option>
                    <option value="Art√≠culo de revista">Art√≠culo de revista</option>
                    <option value="Proceedings">Proceedings de conferencia</option>
                    <option value="Cap√≠tulo de libro">Cap√≠tulo de libro</option>
                    <option value="Libro completo">Libro completo</option>
                    <option value="Preprint">Preprint (arXiv, bioRxiv, etc.)</option>
                    <option value="Dataset">Dataset cient√≠fico</option>
                    <option value="Otra publicaci√≥n con DOI">Otra publicaci√≥n con DOI</option>
                </select>
                <input type="text" name="doi${doiCount}" placeholder="DOI (Ej: 10.1234/revista.2025.001)">
                <button type="button" class="btn-remove" onclick="removerDoi(this)">‚úï</button>
            `;
            container.appendChild(div);
        }

        function removerDoi(button) {
            button.parentElement.remove();
            doiCount--;
        }

        document.getElementById('investigadorForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = new FormData(this);
            const data = {};

            // Convertir FormData a objeto (excepto archivos)
            for (let [key, value] of formData.entries()) {
                if (!(value instanceof File)) {
                    data[key] = value;
                }
            }

            // Recopilar proyectos vigentes
            data.proyectosVigentes = [];
            const proyectosElements = document.querySelectorAll('[id^="proyecto_"]');
            
            proyectosElements.forEach(proyectoDiv => {
                const id = proyectoDiv.id.split('_')[1];
                const financiamiento = formData.get(`proyectos[${id}][financiamiento]`);
                const nombre = formData.get(`proyectos[${id}][nombre]`);
                
                if (!financiamiento || !nombre) {
                    return; // Saltar si faltan datos b√°sicos
                }
                
                const proyecto = {
                    financiamiento: financiamiento,
                        nombre: nombre
                };
                
                if (financiamiento === 'Interno IPN') {
                    // Proyectos internos: usar categor√≠a, tipo y clave SIP (obligatoria)
                    const categoria = document.getElementById(`categoria_${id}`)?.value;
                    const tipo = document.getElementById(`tipo_${id}`)?.value;
                    const claveSIP = formData.get(`proyectos[${id}][claveSIP]`);
                    
                    if (categoria && tipo && claveSIP) {
                        proyecto.categoria = categoria;
                        proyecto.tipo = tipo;
                        proyecto.claveSIP = claveSIP;
                        data.proyectosVigentes.push(proyecto);
                    }
                    
                } else if (financiamiento === 'Externo') {
                    // Proyectos externos: usar fuente, categor√≠a externa, tipo y descripci√≥n
                    const fuenteExterna = formData.get(`proyectos[${id}][fuenteExterna]`);
                    const categoriaExterna = formData.get(`proyectos[${id}][categoriaExterna]`);
                    const tipoExterno = formData.get(`proyectos[${id}][tipoExterno]`);
                    const descripcionExterno = formData.get(`proyectos[${id}][descripcionExterno]`);
                    const claveSIPExterna = formData.get(`proyectos[${id}][claveSIPExterna]`);
                    
                    if (fuenteExterna && categoriaExterna && tipoExterno) {
                        proyecto.fuenteExterna = fuenteExterna;
                        proyecto.categoria = categoriaExterna;
                        proyecto.tipo = tipoExterno;
                        if (descripcionExterno && descripcionExterno.trim()) {
                            proyecto.descripcion = descripcionExterno;
                        }
                        if (claveSIPExterna && claveSIPExterna.trim()) {
                            proyecto.claveSIP = claveSIPExterna;
                        }
                        data.proyectosVigentes.push(proyecto);
                    }
                }
            });

            // Validar que si tiene proyecto vigente, agreg√≥ al menos uno
            if (data.tieneProyectoVigente === 'Si' && data.proyectosVigentes.length === 0) {
                alert('Por favor, agregue al menos un proyecto vigente usando el bot√≥n "‚ûï Agregar Proyecto"');
                return;
            }

            // Recopilar l√≠neas de investigaci√≥n
            data.lineasInvestigacion = [];
            for (let i = 1; i <= lineaCount; i++) {
                const linea = formData.get(`linea${i}`);
                if (linea && linea.trim()) {
                    data.lineasInvestigacion.push(linea.trim());
                }
            }

            // Recopilar publicaciones 2025 (DOIs)
            data.publicaciones2025 = [];
            for (let i = 1; i <= doiCount; i++) {
                const tipo = formData.get(`tipoDoi${i}`);
                const doi = formData.get(`doi${i}`);
                if (doi && doi.trim()) {
                    data.publicaciones2025.push({
                        tipo: tipo || 'No especificado',
                        doi: doi.trim()
                    });
                }
            }

            // Obtener archivo SNII si existe
            const sniiConstancia = document.getElementById('sniiConstancia');
            const archivoSNII = sniiConstancia.files[0];

            console.log('Datos del formulario:', data);
            if (archivoSNII) {
                console.log('Archivo SNII:', archivoSNII.name, archivoSNII.size, 'bytes');
            }

            try {
                // Crear FormData para enviar con archivo
                const envioFormData = new FormData();
                
                // Agregar datos como JSON
                envioFormData.append('datos', JSON.stringify(data));
                
                // Agregar archivo si existe
                if (archivoSNII) {
                    envioFormData.append('sniiConstancia', archivoSNII);
                }

                // Enviar datos al servidor
                const response = await fetch('/api/formulario-investigador', {
                    method: 'POST',
                    body: envioFormData
                });

                if (response.ok) {
                    const result = await response.json();
                    
                    // Actualizar mensaje de √©xito
                    let mensaje = '‚úì Formulario enviado exitosamente. Gracias por su participaci√≥n.';
                    if (result.constancia_snii) {
                        mensaje += `<br><strong>‚úì Constancia SNII guardada:</strong> ${result.constancia_snii}`;
                    }
                    document.getElementById('successMessage').innerHTML = mensaje;
                    
                    document.getElementById('successMessage').style.display = 'block';
                    document.getElementById('errorMessage').style.display = 'none';
                    
                    // Scroll al mensaje de √©xito
                    document.getElementById('successMessage').scrollIntoView({ behavior: 'smooth' });

                    // Descargar tambi√©n como JSON en el navegador
                    descargarJSON(data);

                    // Reiniciar formulario despu√©s de 3 segundos
                    setTimeout(() => {
                        this.reset();
                        lineaCount = 3;
                        doiCount = 1;
                        proyectoCount = 0;
                        categoriasUsadas.clear();
                        document.getElementById('successMessage').style.display = 'none';
                        
                        // Limpiar contenedores din√°micos adicionales
                        const lineasContainer = document.getElementById('lineasContainer');
                        while (lineasContainer.children.length > 3) {
                            lineasContainer.removeChild(lineasContainer.lastChild);
                        }
                        
                        const doisContainer = document.getElementById('doisContainer');
                        while (doisContainer.children.length > 1) {
                            doisContainer.removeChild(doisContainer.lastChild);
                        }
                        
                        const proyectosContainer = document.getElementById('proyectosListaContainer');
                        proyectosContainer.innerHTML = '';
                    }, 3000);
                } else {
                    throw new Error('Error al enviar');
                }
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('errorMessage').style.display = 'block';
                document.getElementById('successMessage').style.display = 'none';
                document.getElementById('errorMessage').scrollIntoView({ behavior: 'smooth' });
            }
        });

        function descargarJSON(data) {
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `investigador_${data.claveEmpleado}_${Date.now()}.json`;
            link.click();
        }
    </script>
</body>
</html>

